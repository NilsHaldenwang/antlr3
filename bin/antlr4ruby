#!/usr/bin/ruby
# encoding: utf-8

__DIR__ = File.expand_path( File.dirname __FILE__ )
project_top = File.dirname __DIR__
load( File.join( project_top, 'lib', 'antlr3', 'version.rb' ) )

jar_name = "antlr-full-#{ ANTLR_VERSION_STRING }.jar"
jar_path = File.join( project_top, 'java', jar_name )

unless File.exist?( jar_path )
  $stderr.puts(<<-END.strip!.gsub!(/\s+/, ' '))
    the ANTLR #{ ANTLR_VERSION_STRING } jar is expected
    to be located at #{ jar_path }, but it does not
    appear to exist.
  END
  exit( 1 )
end

escape = proc do | a |
  if a.empty? then "''"
  else
    a.gsub( /([^A-Za-z0-9_\-.,:\/@\n])/n, '\\\1' ).
      gsub( /\n/, "'\n'" )
  end
end

command = %w(java -jar) << escape[ antlr_jar ]
for arg in ARGV
  command << escape[ arg ]
end

exec command.join(' ')
